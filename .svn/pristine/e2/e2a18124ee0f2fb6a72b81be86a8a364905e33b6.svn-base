<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * Chart Class
 *
 * @package		LookingGlassSAE
 * @subpackage	Controllers
 * @category	Controller
 * @author		WDLTH
 * @link		http://www.wdlth.com/
 */

class Chart extends CI_Controller {

	function __construct() {
		parent::__construct();
	}
	
	public function index()
	{
		exit('403 Forbidden.');
	}
	
	public function source()
	{
		$this->load->library('Dblib');
		$sourcearr = $this->dblib->getChartSource();
		$xml = new SimpleXMLElement('<chart/>');
		foreach ($sourcearr as $source)
		{
			$series = $xml->addChild('series');
			$series->addChild('name', $source["source"]);
			$data = $series->addChild('data');
			$pointarr = $this->dblib->getChartPoint($source["source"], 'ChinaTelecom');
			for ($l = 1; $l <= 24; $l++)
			{
				if($l % 2 == 1)
				{
					//$data->addChild('point', intval($pointarr[$l]["avg"]));
				}
					
			}
			
		}
		echo $xml->asXML();
	}
	
	public function timeline()
	{
		$timelinearr = array();
		for($i = 0; $i < 12; $i++)
		{
			$timelinearr[$i] = date("H", strtotime("-" . $i . " hours")) . ":00";
		}
		$timelinearr = array_reverse($timelinearr);
		
		$xml = new SimpleXMLElement('<chart/>');
		$categories = $xml->addChild('categories');
		for($j = 0; $j < count($timelinearr); $j++)
		{
			$categories -> addChild('item', $timelinearr[$j]);
		}
		header('Content-type: text/xml');
		echo $xml->asXML();
	}

}