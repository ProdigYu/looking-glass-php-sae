<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * Chart Class
 *
 * @package		LookingGlassSAE
 * @subpackage	Controllers
 * @category	Controller
 * @author		WDLTH
 * @link		http://www.wdlth.com/
 */

class Chart extends CI_Controller {

	function __construct() {
		parent::__construct();
	}
	
	public function index()
	{
		exit('403 Forbidden.');
	}
	
	public function source()
	{
		$this->load->library('Dblib');
		$sourcearr = $this->dblib->getChartSource();
		$xml = new SimpleXMLElement('<chart/>');
		foreach ($sourcearr as $source)
		{
			$series = $xml->addChild('series');
			$series->addChild('name', $source["source"]);
			$data = $series->addChild('data');
			$pointarr = $this->dblib->getChartPoint($source["source"], 'ChinaTelecom');
			for ($l = 1; $l <= 24; $l++)
			{
				if($l % 2 == 1)
				{
					//$data->addChild('point', intval($pointarr[$l]["avg"]));
				}
					
			}
			print_r($pointarr);
			
		}
		//echo $xml->asXML();
		
	}
	
	public function timeline()
	{
		$timelinearr = array();
		if(intval(date("m")) > 35 || intval(date("m")) <=15 )
		{
			for($i = 1; $i < 12; $i+2)
			{
				$timelinearr[$i] = date("H", strtotime("-" . $i . " hours")) . ":30";
			}
			for($i = 0; $i <= 12; $i+2)
			{
				$timelinearr[$i] = date("H", strtotime("-" . $i . " hours")) . ":00";
			}
		}else{
			if(intval(date("m")) > 15 || intval(date("m")) <=35)
			{	
				for($i = 1; $i < 12; $i+2)
				{
					$timelinearr[$i] = date("H", strtotime("-" . $i . " hours")) . ":00";
				}
				for($i = 0; $i <= 12; $i+2)
				{
					$timelinearr[$i] = date("H", strtotime("-" . $i . " hours")) . ":30";
				}
			}
		}
		$timelinearr = array_reverse($timelinearr);
		
		$xml = new SimpleXMLElement('<chart/>');
		$categories = $xml->addChild('categories');
		for($j = 0; $j < count($timelinearr); $j++)
		{
			$categories -> addChild('item', $timelinearr[$j]);
		}
		header('Content-type: text/xml');
		echo $xml->asXML();
	}

}