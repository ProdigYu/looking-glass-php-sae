<!doctype html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Looking Glass(Beta!)</title>

<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" type="text/css">

<style type="text/css">
.chartheader{
	min-width:780px;
	height:450px;
}
.chart{
	min-width:780px;
	height:400px;
}

</style>

<!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" type="text/javascript"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" type="text/javascript"></script>
    <![endif]-->

<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.js" type="text/javascript"></script>
<script src="http://cdn.bootcss.com/highcharts/3.0.9/highcharts.js"></script>
<script src="http://cdn.bootcss.com/highcharts/3.0.9/modules/exporting.js"></script>
{literal}
<script type="text/javascript">
$(document).ready(function () { 

    var options_telecom = {
		chart: {
			renderTo: 'chinatelecom',
			type: 'line'
		},
		title: {
			text: 'Looking Glass',
			x: -20
		},
		subtitle: {
			text: '最新数据',
			x: -20
		},
		xAxis: {
			categories: []
		},
		yAxis: [{
			labels: {
				format: '{value}ms',
			},
			title: {
				text: '平均延迟(ms)'
			},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#66ccff'
			}]
		},{
			labels: {
				format: '{value}%',
			},
			title: {
				text: '丢包率(%)'
			},
			opposite: true,
			plotLines: [{
				value: 0,
				width: 1,
				color: '#ff0000'
			}]
		}],
		tooltip: {
			shared: true
		},
		plotOptions: {
			line: {
				dataLabels: {
					enabled: true
				},
			}
		},
		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'middle',
			borderWidth: 0
		},
		series: []
	};
	
	var options_unicom = {
		chart: {
			renderTo: 'chinaunicom',
			type: 'line'
		},
		title: {
			text: 'Looking Glass',
			x: -20
		},
		subtitle: {
			text: '最新数据',
			x: -20
		},
		xAxis: {
			categories: []
		},
		yAxis: [{
			labels: {
				format: '{value}ms',
			},
			title: {
				text: '平均延迟(ms)'
			},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#66ccff'
			}]
		},{
			labels: {
				format: '{value}%',
			},
			title: {
				text: '丢包率(%)'
			},
			opposite: true,
			plotLines: [{
				value: 0,
				width: 1,
				color: '#ff0000'
			}]
		}],
		tooltip: {
			valueSuffix: 'ms'
		},
		plotOptions: {
			line: {
				dataLabels: {
					enabled: true
				},
			}
		},
		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'middle',
			borderWidth: 0
		},
		series: []
	};
	
	var options_mobile = {
		chart: {
			renderTo: 'chinamobile',
			type: 'line'
		},
		title: {
			text: 'Looking Glass',
			x: -20
		},
		subtitle: {
			text: '最新数据',
			x: -20
		},
		xAxis: {
			categories: []
		},
		yAxis: [{
			labels: {
				format: '{value}ms',
			},
			title: {
				text: '平均延迟(ms)'
			},
			plotLines: [{
				value: 0,
				width: 1,
				color: '#66ccff'
			}]
		},{
			labels: {
				format: '{value}%',
			},
			title: {
				text: '丢包率(%)'
			},
			opposite: true,
			plotLines: [{
				value: 0,
				width: 1,
				color: '#ff0000'
			}]
		}],
		tooltip: {
			valueSuffix: 'ms'
		},
		plotOptions: {
			line: {
				dataLabels: {
					enabled: true
				},
			}
		},
		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'middle',
			borderWidth: 0
		},
		series: []
	};
	
	$.get('/chart/telecom', function(xml) {
		var $xml = $(xml);
		
		$xml.find('categories item').each(function(i, category) {
			options_telecom.xAxis.categories.push($(category).text());
		});
		
		$xml.find('series').each(function(i, series) {
			var seriesOptions = {
				name: $(series).find('name').text(),
				data: [],
				tooltip: {
					valueSuffix: 'ms'
				}
			};
			var seriesOptions2 = {
				type: 'column',
				name: $(series).find('name').text(),
				data: [],
				yAxis: 1,
				tooltip: {
					valueSuffix: '%'
				}
			};
			$(series).find('data point').each(function(i, point) {
				seriesOptions.data.push(
				parseInt($(point).text())
				);
			});
			$(series).find('data loss').each(function(i, loss) {
				seriesOptions2.data.push(
				parseInt($(loss).text())
				);
			});
			options_telecom.series.push(seriesOptions);
			options_telecom.series.push(seriesOptions2);
		});
		var chart = new Highcharts.Chart(options_telecom);
	});
	
	$.get('/chart/unicom', function(xml) {
		var $xml = $(xml);
		
		$xml.find('categories item').each(function(i, category) {
			options_unicom.xAxis.categories.push($(category).text());
		});
		
		$xml.find('series').each(function(i, series) {
			var seriesOptions = {
				name: $(series).find('name').text(),
				data: [],
				tooltip: {
					valueSuffix: 'ms'
				}
			};
			var seriesOptions2 = {
				type: 'column',
				name: $(series).find('name').text(),
				data: [],
				yAxis: 1,
				tooltip: {
					valueSuffix: '%'
				}
			};
			$(series).find('data point').each(function(i, point) {
				seriesOptions.data.push(
				parseInt($(point).text())
				);
			});
			$(series).find('data loss').each(function(i, loss) {
				seriesOptions2.data.push(
				parseInt($(loss).text())
				);
			});
			options_unicom.series.push(seriesOptions);
			options_unicom.series.push(seriesOptions2);
		});
		var chart = new Highcharts.Chart(options_unicom);
	});
	
	$.get('/chart/mobile', function(xml) {
		var $xml = $(xml);
		
		$xml.find('categories item').each(function(i, category) {
			options_mobile.xAxis.categories.push($(category).text());
		});
		
		$xml.find('series').each(function(i, series) {
			var seriesOptions = {
				name: $(series).find('name').text(),
				data: [],
				tooltip: {
					valueSuffix: 'ms'
				}
			};
			var seriesOptions2 = {
				type: 'column',
				name: $(series).find('name').text(),
				data: [],
				yAxis: 1,
				tooltip: {
					valueSuffix: '%'
				}
			};
			$(series).find('data point').each(function(i, point) {
				seriesOptions.data.push(
				parseInt($(point).text())
				);
			});
			$(series).find('data loss').each(function(i, loss) {
				seriesOptions2.data.push(
				parseInt($(loss).text())
				);
			});
			options_mobile.series.push(seriesOptions);
			options_mobile.series.push(seriesOptions2);
		});
		var chart = new Highcharts.Chart(options_mobile);
	});
		
});
</script>
{/literal}

</head>

<body>
<h2>Looking Glass正在收集数据和进行测试</h2>
<h3>与BGPlay功能不同，这个工具只采集Ping数据。</h3>
<h4>数据来自超过10个不同ISP或者机房的Looking Glass。目前先拿几个进行功能测试</h4>
<h5>数据仅供参考。</h5>
<br />
<h5>以下是最新数据：</h5>
<div class="container">
<div id="chartheader" class="chartheader">
<ul id="chartTab" class="nav nav-tabs">
        <li class="active"><a href="#chinatelecom" data-toggle="tab">中国电信</a></li>
        <li class=""><a href="#chinaunicom" data-toggle="tab">中国联通</a></li>
        <li class=""><a href="#chinamobile" data-toggle="tab">中国移动</a></li>
      </ul>
      <div id="chart" class="tab-content">
      <div id="chinatelecom" class="chart tab-pane fade active in">
      </div>
      <div id="chinaunicom" class="chart tab-pane fade">
      </div>
      <div id="chinamobile" class="chart tab-pane fade">
      </div>
      <script type="text/javascript">
$('#chartTab a').click(function (e) {
  e.preventDefault()
  $(this).tab('show')
})
</script>
</div>
<div class="col-xs-12">
<table id="example" class="table table-striped col-xs-10">
<thead>
          <tr>
            <th>数据源</th>
            <th>最低延迟</th>
            <th>平均延迟</th>
            <th>最高延迟</th>
            <th>丢包率</th>
            <th>测试时间</th>
          </tr>
        </thead>
        <tbody>
        <tr>
        <td colspan="6">
        中国电信
        </td>
        </tr>
        {foreach from=$ctArray item=ctItem}
        <tr>
        <td>
        {$ctItem.source}
        </td>
        <td>
        {$ctItem.min}ms
        </td>
        <td>
        {$ctItem.avg}ms
        </td>
        <td>
        {$ctItem.max}ms
        </td>
        <td>
        {$ctItem.loss}%
        </td>
        <td>
        {$ctItem.time}
        </td>
        </tr>
        {/foreach}
        <tr>
        <td colspan="6">
        中国联通
        </td>
        </tr>
        {foreach from=$cuArray item=cuItem}
        <tr>
        <td>
        {$cuItem.source}
        </td>
        <td>
        {$cuItem.min}ms
        </td>
        <td>
        {$cuItem.avg}ms
        </td>
        <td>
        {$cuItem.max}ms
        </td>
        <td>
        {$cuItem.loss}%
        </td>
        <td>
        {$cuItem.time}
        </td>
        </tr>
        {/foreach}
        <tr>
        <td colspan="6">
        中国移动
        </td>
        </tr>
        {foreach from=$cmArray item=cmItem}
        <tr>
        <td>
        {$cmItem.source}
        </td>
        <td>
        {$cmItem.min}ms
        </td>
        <td>
        {$cmItem.avg}ms
        </td>
        <td>
        {$cmItem.max}ms
        </td>
        <td>
        {$cmItem.loss}%
        </td>
        <td>
        {$cmItem.time}
        </td>
        </tr>
        {/foreach}
        </tbody>
</table>
</div>
</div>


<footer class="text-right"><img src="/images/poweredbysae-120x33px.png" width="120px" height="33px" alt="Powered By SinaAppEngine">Page rendered in <strong>{$elapsed_time}</strong> seconds, used <strong>{$memory_get_usage}</strong> KB memory.</footer>
</body>
</html>
